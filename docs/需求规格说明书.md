# PulseLink 需求规格说明书

## 一、项目概述

### 1.1 项目目标

彻底解决原有系统痛点：

- 客户端连接不稳定、频繁掉线
- 设备状态错乱、显示离线
- 第三方系统获取不到实时数据

### 1.2 架构方案

采用**事件驱动架构**：

- **Redis Pub/Sub**： 完全取代定时任务和任务队列
- **多实例部署**： Nginx 负载均衡
- **状态集中存储**：Redis 作为单一真相源
- **跨节点通信**：通过 Pub/Sub 事件广播

### 1.3 核心原则

- **事件驱动**：上线/下线/心跳/数据请求 全部通过 Pub/Sub
- **状态集中**：Redis 存储所有状态，带自动过期机制
- **连接本地化**：每个实例只管理自己连接的客户端
- **查询任意化**：任意实例都能处理请求（依赖 Redis + Pub/Sub）

---

## 二、功能清单

### 1. 客户端连接与注册

#### 1.1 客户端连接

- **编号**：F001
- **描述**：客户端通过 WSS 协议连接到服务器
- **输入**：客户端发起 WebSocket 连接（`wss://域名:443/ws`）
- **处理流程**：
  1. Nginx 接收 WSS 连接请求（443 端口）
  2. Nginx 通过 least_conn 策略转发到某个 Spring Boot 实例
  3. Spring Boot 实例的 Netty Server 接受连接
  4. 记录日志：`INFO - 客户端连接建立，channel={}`
- **输出**：WebSocket 连接建立成功

#### 1.2 客户端注册

- **编号**：F002
- **描述**：客户端连接成功后立即发送注册消息
- **输入**：

  ```json
  {
    "mapper": "register",
    "body": {
      "deviceId": "device-001",
      "ip": "192.168.1.100"
    }
  }
  ```

- **处理流程**：
  1. 验证 JSON 格式（deviceId 非空）
  2. 将 deviceId 加入 Redis Set `devices:online`
  3. 初始化心跳时间到 Redis String `device:heartbeat:{deviceId}`（有效期 120s）
  4. 发布 Pub/Sub 事件到 `client:status:change`：

     ```json
     {
       "deviceId": "device-001",
       "status": "online",
       "timestamp": 1736976000000
     }
     ```

  5. 异步 POST 通知第三方：`https://ip/device/api/updateDeviceStatus`

     ```json
     {
       "deviceId": "device-001",
       "status": "online"
     }
     ```

  6. 返回成功响应给客户端
- **输出**：

  ```json
  {
    "code": 200,
    "message": "注册成功",
    "data": null
  }
  ```

- **异常处理**：
  - JSON 格式错误 → ERROR 日志 + 返回 `ApiResult.fail("JSON格式错误")`
  - deviceId 为空 → ERROR 日志 + 返回 `ApiResult.fail("deviceId不能为空")`

---

### 2. 心跳检测与离线判断

#### 2.1 客户端心跳发送

- **编号**：F003
- **描述**：客户端每 30 秒发送一次心跳
- **输入**：

  ```json
  {
    "mapper": "ping",
    "body": {
      "deviceId": "device-001",
      "timestamp": 1736976000000
    }
  }
  ```

- **处理流程**：
  1. 更新 Redis String `device:heartbeat:{deviceId}` = 当前时间戳（有效期 120s）
  2. 发布 Pub/Sub 事件到 `client:heartbeat`（可选，用于监控）
  3. 返回 pong 响应
- **输出**：

  ```json
  {
    "mapper": "pong",
    "body": {
      "timestamp": 1736976000000
    }
  }
  ```

#### 2.2 心跳超时检测

- **编号**：F004
- **描述**：检测客户端心跳超时，自动标记离线
- **触发方式**：Redis Key 过期自动触发
- **处理流程**：
  1. Redis String `device:heartbeat:{deviceId}` 过期（120s 无心跳）
  2. 监听过期事件 或 轻量级定时扫描（每 60s）
  3. 从 Redis Set `devices:online` 中移除该 deviceId
  4. 发布 Pub/Sub 事件到 `client:status:change`：

     ```json
     {
       "deviceId": "device-001",
       "status": "offline",
       "timestamp": 1736976000000,
       "reason": "heartbeat_timeout"
     }
     ```

  5. POST 通知第三方：`https://ip/device/api/updateDeviceStatus`

     ```json
     {
       "deviceId": "device-001",
       "status": "offline"
     }
     ```

  6. 记录日志：`INFO - 设备离线（心跳超时），deviceId={}`
- **输出**：设备状态更新为离线

#### 2.3 连接断开处理

- **编号**：F005
- **描述**：处理客户端主动断开或异常掉线
- **输入**：Netty `channelInactive()` 事件
- **处理流程**：
  1. 判断关闭类型：
     - **正常关闭**：客户端发送 close 帧
       - 立即从 Redis Set `devices:online` 移除
       - 发布 `client:status:change` 事件（status=offline）
       - POST 通知第三方
       - 记录日志：`INFO - 客户端正常断开，deviceId={}`
     - **异常掉线**：网络中断、超时等
       - 等待心跳超时（由 F004 处理）
       - 记录日志：`WARN - 客户端异常掉线，deviceId={}，等待心跳超时`
- **输出**：连接资源释放，状态更新

---

### 3. 运行数据查询与上报

#### 3.1 第三方查询运行数据

- **编号**：F006
- **描述**：第三方系统通过 HTTP API 查询客户端运行数据
- **输入**：`GET /api/client/{deviceId}/runtimeinfo`
- **处理流程**：
  1. **检查缓存**：查询 Redis String `device:runtimeInfo:{deviceId}`
  2. **有缓存且未过期**（300s 内）：
     - 直接返回缓存数据

     ```json
     {
       "code": 200,
       "message": "success",
       "data": {
         "deviceId": "device-001",
         "cpu": "50%",
         "ram": "8GB/16GB",
         "disk": "200GB/500GB",
         "uptime": "72h30m"
       }
     }
     ```

  3. **无缓存或已过期**：
     - 检查设备是否在线（`devices:online` Set）
     - **如果离线**：返回 `ApiResult.fail("设备离线或数据过期")`
     - **如果在线**：
       1. 生成唯一 requestId（UUID）
       2. 发布 Pub/Sub 事件到 `client:data:request`：

          ```json
          {
            "deviceId": "device-001",
            "requestId": "req-uuid-123",
            "timestamp": 1736976000000
          }
          ```

       3. 持有该客户端连接的实例收到事件
       4. 通过本地 Netty Channel 发送消息给客户端：

          ```json
          {
            "mapper": "getRuntimeInfo",
            "body": {
              "requestId": "req-uuid-123"
            }
          }
          ```

       5. 客户端响应后，跳转到 **F007**
       6. 等待数据到达（最多 5 秒超时）
       7. 从 Redis 获取最新数据并返回
- **输出**：`ApiResult<RuntimeInfo>`

#### 3.2 客户端上报运行数据

- **编号**：F007
- **描述**：客户端收到请求后上报运行数据
- **输入**：

  ```json
  {
    "mapper": "runtimeInfo",
    "body": {
      "deviceId": "device-001",
      "requestId": "req-uuid-123",
      "cpu": "50%",
      "ram": "8GB/16GB",
      "disk": "200GB/500GB",
      "uptime": "72h30m",
      "network": {
        "in": "1.2MB/s",
        "out": "0.8MB/s"
      },
      "processes": 145
    }
  }
  ```

- **处理流程**：
  1. 验证 JSON 格式和必要字段
  2. 将 body 转换为 JSON 字符串，存入 Redis String `device:runtimeInfo:{deviceId}`（有效期 300s）
  3. 发布 Pub/Sub 事件到 `client:data:updated`：

     ```json
     {
       "deviceId": "device-001",
       "requestId": "req-uuid-123",
       "timestamp": 1736976000000
     }
     ```

  4. 记录日志：`DEBUG - 运行数据已更新，deviceId={}，requestId={}`
  5. （可选）如果有等待的 HTTP 请求，唤醒并返回数据
- **输出**：

  ```json
  {
    "code": 200,
    "message": "数据上报成功",
    "data": null
  }
  ```

---

### 4. 第三方状态通知

#### 4.1 设备上线通知

- **编号**：F008
- **描述**：设备上线时通知第三方系统
- **输入**：来自 F002 的上线事件
- **处理流程**：
  1. 异步发送 POST 请求到 `https://ip/device/api/updateDeviceStatus`
  2. 请求体：

     ```json
     {
       "deviceId": "device-001",
       "status": "online"
     }
     ```

  3. **成功**（HTTP 200）：记录日志：`INFO - 上线通知成功，deviceId={}`
  4. **失败**：指数退避重试（最多 3 次）
     - 第 1 次：立即重试
     - 第 2 次：等待 1s 后重试
     - 第 3 次：等待 2s 后重试
     - 第 4 次：等待 4s 后重试
     - 仍失败：记录 ERROR 日志
- **输出**：通知完成或重试队列

#### 4.2 设备离线通知

- **编号**：F009
- **描述**：设备离线时通知第三方系统
- **输入**：来自 F004 或 F005 的离线事件
- **处理流程**：与 F008 相同，但 status 为 `offline`
- **输出**：通知完成或重试队列

---

### 5. 多实例节点管理

#### 5.1 节点注册

- **编号**：F010
- **描述**：服务实例启动时注册到 Redis
- **触发时机**：Spring Boot 应用启动
- **处理流程**：
  1. 生成实例 UUID（如 `node-uuid-123`）
  2. 加入 Redis Set `nodes:online`
  3. 初始化心跳时间到 Redis String `node:heartbeat:{UUID}`（有效期 120s）
  4. 记录日志：`INFO - 节点启动并注册，nodeId={}`
- **输出**：节点在线

#### 5.2 节点心跳

- **编号**：F011
- **描述**：每个实例定期发送心跳，保持在线状态
- **触发时机**：定时任务，每 20 秒执行一次
- **处理流程**：
  1. 更新 Redis String `node:heartbeat:{UUID}` = 当前时间戳（有效期 120s）
  2. 记录日志：`DEBUG - 节点心跳更新，nodeId={}`
- **输出**：心跳时间更新

#### 5.3 节点超时检测

- **编号**：F012
- **描述**：检测并清理超时的离线节点
- **触发时机**：主节点定时扫描（每 60 秒）
- **主节点选举**：通过 Redis 分布式锁（`lock:node:master`）选举
- **处理流程**：
  1. 尝试获取分布式锁（TTL 30s）
  2. **获取锁成功**（成为主节点）：
     - 扫描 Redis Set `nodes:online` 中的所有 nodeId
     - 检查对应的 `node:heartbeat:{nodeId}` 是否存在
     - **如果不存在**（已超时）：
       - 从 `nodes:online` 中移除
       - 记录日志：`WARN - 节点超时离线，nodeId={}`
     - 释放锁
  3. **获取锁失败**：
     - 跳过本次扫描（其他节点是主节点）
- **输出**：离线节点清理

---

### 6. 日志与异常处理

#### 6.1 日志记录

- **编号**：F013
- **描述**：记录系统运行过程中的关键事件
- **日志级别**：
  - **DEBUG**：详细流程、测试用（心跳更新、Pub/Sub 事件）
  - **INFO**：正常流程（连接建立、注册成功、通知成功）
  - **WARN**：警告信息（异常掉线、节点超时）
  - **ERROR**：失败和异常（JSON 解析失败、通知失败）
- **必须记录的操作**：
  - 客户端连接建立/断开
  - 注册成功/失败
  - 心跳接收（DEBUG 级别）
  - 上/下线事件
  - 第三方通知成功/失败
  - JSON 解析异常
  - 运行数据更新（DEBUG 级别）
  - 节点启动/心跳/超时
- **日志框架**：SLF4J + Logback

#### 6.2 JSON 解析异常处理

- **编号**：F014
- **描述**：处理客户端发送的错误 JSON 格式
- **输入**：无法解析的 JSON 字符串
- **处理流程**：
  1. 捕获 `JsonParseException` 或 `JSONException`
  2. 记录 ERROR 日志：`ERROR - JSON解析失败，rawMessage={}，error={}`
  3. 返回错误响应：

     ```json
     {
       "code": 400,
       "message": "JSON格式错误",
       "data": null
     }
     ```

  4. **不关闭连接**（除非严重错误）
- **输出**：错误响应

---

## 三、数据格式示例

### 3.1 WebSocket 消息格式（统一）

**通用结构**：

```json
{
  "mapper": "消息类型",
  "body": {
    // 具体数据
  }
}
```

#### 客户端 → 服务器

**注册消息**：

```json
{
  "mapper": "register",
  "body": {
    "deviceId": "device-001",
    "ip": "192.168.1.100",
    "version": "1.0.0"
  }
}
```

**心跳消息**：

```json
{
  "mapper": "ping",
  "body": {
    "deviceId": "device-001",
    "timestamp": 1736976000000
  }
}
```

**运行数据上报**：

```json
{
  "mapper": "runtimeInfo",
  "body": {
    "deviceId": "device-001",
    "requestId": "req-uuid-123",
    "cpu": "50%",
    "ram": "8GB/16GB",
    "disk": "200GB/500GB",
    "uptime": "72h30m",
    "network": {
      "in": "1.2MB/s",
      "out": "0.8MB/s"
    },
    "processes": 145,
    "os": "Windows 10",
    "appVersion": "1.0.0"
  }
}
```

#### 服务器 → 客户端

**注册响应**：

```json
{
  "code": 200,
  "message": "注册成功",
  "data": null
}
```

**心跳响应**：

```json
{
  "mapper": "pong",
  "body": {
    "timestamp": 1736976000000
  }
}
```

**请求运行数据**：

```json
{
  "mapper": "getRuntimeInfo",
  "body": {
    "requestId": "req-uuid-123"
  }
}
```

---

### 3.2 HTTP 接口格式

#### 查询运行数据

**请求**：

```text
GET /api/client/device-001/runtimeinfo
```

**成功响应**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "deviceId": "device-001",
    "cpu": "50%",
    "ram": "8GB/16GB",
    "disk": "200GB/500GB",
    "uptime": "72h30m",
    "network": {
      "in": "1.2MB/s",
      "out": "0.8MB/s"
    },
    "processes": 145,
    "os": "Windows 10",
    "appVersion": "1.0.0",
    "updateTime": "2025-01-16 12:00:00"
  }
}
```

**失败响应**：

```json
{
  "code": 400,
  "message": "设备离线或数据过期",
  "data": null
}
```

---

### 3.3 第三方通知格式

**请求**：

```text
POST https://ip/device/api/updateDeviceStatus
Content-Type: application/json
```

**请求体**：

```json
{
  "deviceId": "device-001",
  "status": "online"
}
```

或

```json
{
  "deviceId": "device-001",
  "status": "offline"
}
```

---

### 3.4 Pub/Sub 事件格式

#### 设备状态变更事件

**Channel**：`client:status:change`

```json
{
  "deviceId": "device-001",
  "status": "online",
  "timestamp": 1736976000000,
  "reason": "register"
}
```

或

```json
{
  "deviceId": "device-001",
  "status": "offline",
  "timestamp": 1736976000000,
  "reason": "heartbeat_timeout"
}
```

#### 心跳事件

**Channel**：`client:heartbeat`

```json
{
  "deviceId": "device-001",
  "timestamp": 1736976000000
}
```

#### 数据请求事件

**Channel**：`client:data:request`

```json
{
  "deviceId": "device-001",
  "requestId": "req-uuid-123",
  "timestamp": 1736976000000
}
```

#### 数据更新事件

**Channel**：`client:data:updated`

```json
{
  "deviceId": "device-001",
  "requestId": "req-uuid-123",
  "timestamp": 1736976000000
}
```

---

### 3.5 ApiResult 通用响应格式

```java
public class ApiResult<T> {
    private int code;        // 状态码：200-成功，4xx-客户端错误，5xx-服务器错误
    private String message;  // 提示信息
    private T data;          // 数据体（可为 null）

    // 快捷方法
    public static <T> ApiResult<T> success() { ... }
    public static <T> ApiResult<T> success(T data) { ... }
    public static <T> ApiResult<T> fail(String message) { ... }
    public static <T> ApiResult<T> fail(int code, String message) { ... }
}
```

**示例**：

```json
{
  "code": 200,
  "message": "操作成功",
  "data": { ... }
}
```

---

## 四、非功能要求

### 4.1 性能要求

| 指标           | 要求                        | 说明                              |
|----------------|----------------------------|-----------------------------------|
| 并发连接数     | 支持 1000+ 客户端同时在线   | 单实例承载能力                    |
| 心跳响应时间   | < 1 秒                      | 从客户端发送 ping 到收到 pong     |
| Pub/Sub 延迟   | < 100 毫秒                  | 事件发布到订阅者接收的时间        |
| 运行数据查询   | < 5 秒                      | 包括请求客户端、接收数据、返回    |
| HTTP API 响应  | < 500 毫秒                  | 缓存命中情况                      |

### 4.2 可用性要求

| 指标           | 要求                        | 说明                              |
|----------------|----------------------------|-----------------------------------|
| 系统可用率     | ≥ 99.5%                    | 允许停机时间约 3.6 小时/月        |
| 故障恢复时间   | < 30 秒                    | 单实例故障后客户端自动重连        |
| 数据持久化     | 无（运行数据仅缓存）        | Redis 过期后重新拉取              |

### 4.3 扩展性要求

| 指标           | 要求                        | 说明                              |
|----------------|----------------------------|-----------------------------------|
| 横向扩展       | 支持动态增减实例            | 通过 Nginx + Redis 实现无状态     |
| 负载均衡       | least_conn 策略            | Nginx 配置                        |
| 客户端容量     | 线性增长                    | 每增加一个实例，容量约增加 1000   |

### 4.4 安全要求

| 指标           | 要求                        | 说明                              |
|----------------|----------------------------|-----------------------------------|
| WS 认证        | 无                         | 依赖内网隔离策略                  |
| HTTPS/WSS      | 使用自签名证书             | 内网环境可接受                    |
| 数据传输       | 明文（WebSocket JSON）      | 内网安全环境                      |
| 访问控制       | IP 白名单（可选）           | 第三方系统限制访问                |

### 4.5 部署环境

| 项目           | 配置                        | 说明                              |
|----------------|----------------------------|-----------------------------------|
| 操作系统       | Linux / Windows Server     | 推荐 CentOS 7+ 或 Ubuntu 20.04+   |
| JDK 版本       | JDK 17+                    | Spring Boot 3.x 要求              |
| Redis 版本     | 6.0+                       | 支持 Pub/Sub 和过期事件           |
| Nginx 版本     | 1.18+                      | 支持 WebSocket 代理               |
| 网络环境       | 内网                       | 延迟 < 10ms                       |

### 4.6 时间参数配置

| 参数           | 值                          | 说明                              |
|----------------|----------------------------|-----------------------------------|
| 客户端心跳间隔 | 30 秒                      | 客户端定时发送 ping                |
| 心跳超时时间   | 120 秒（4 倍心跳间隔）     | Redis String 过期时间             |
| 运行数据缓存   | 300 秒（5 分钟）           | Redis 过期时间                    |
| 节点心跳间隔   | 20 秒                      | 实例定时更新心跳                  |
| 节点心跳超时   | 120 秒                     | Redis String 过期时间             |
| 主节点扫描间隔 | 60 秒                      | 扫描离线节点                      |
| 第三方通知超时 | 10 秒                      | 单次 HTTP 请求超时                |
| 第三方重试次数 | 3 次                       | 指数退避：1s → 2s → 4s            |

### 4.7 日志要求

| 项目           | 配置                        | 说明                              |
|----------------|----------------------------|-----------------------------------|
| 日志框架       | SLF4J + Logback            | Spring Boot 默认                  |
| 日志级别       | INFO（生产）/ DEBUG（开发）| 可通过配置文件调整                |
| 日志输出       | 文件 + 控制台              | 按天滚动，保留 30 天              |
| 日志格式       | JSON / 文本                 | 推荐文本格式（便于阅读）           |
| 关键操作日志   | 必须记录                    | 见 F013 功能清单                  |

### 4.8 客户端行为要求

| 项目           | 配置                        | 说明                              |
|----------------|----------------------------|-----------------------------------|
| 连接地址       | 硬编码 WSS://URL           | 如 `wss://192.168.1.10/ws`        |
| 证书验证       | 跳过（自签名证书）          | 内网环境可接受                    |
| 断线重连       | 自动重连，间隔 30 秒       | 指数退避，最多重试 10 次          |
| 心跳发送       | 每 30 秒一次               | 固定间隔                          |
| 数据上报       | 响应式（服务器请求后上报）  | 非定时上报                        |
| 消息格式       | JSON                       | 统一格式                          |

### 4.9 容错与异常处理

| 场景           | 处理方式                    | 说明                              |
|----------------|----------------------------|-----------------------------------|
| JSON 解析失败  | 不关闭连接，返回错误        | 记录 ERROR 日志                   |
| 第三方通知失败 | 指数退避重试 3 次           | 失败后记录 ERROR 日志             |
| 客户端无响应   | 5 秒超时，返回失败          | 运行数据查询场景                  |
| Redis 连接断开 | 记录 ERROR，拒绝新连接      | 等待恢复或重启                    |
| 异常掉线       | 等待心跳超时后清理          | 不立即触发离线事件                |

### 4.10 监控与运维（可选）

| 项目           | 配置                        | 说明                              |
|----------------|----------------------------|-----------------------------------|
| 在线设备数     | 实时监控                    | Redis `devices:online` Set 大小   |
| 在线节点数     | 实时监控                    | Redis `nodes:online` Set 大小     |
| 心跳统计       | 每分钟统计                  | 心跳接收次数 / 在线设备数         |
| 查询响应时间   | P95、P99 延迟统计           | 运行数据查询 API                  |
| 通知成功率     | 每小时统计                  | 第三方通知成功 / 总次数           |

---

## 五、Redis Key 设计

### 5.1 数据结构

| Key 模式                     | 类型   | 用途                       | 过期时间 | 说明                |
|------------------------------|--------|----------------------------|----------|---------------------|
| `devices:online`             | Set    | 在线设备列表               | 无       | 存在 = online       |
| `device:heartbeat:{deviceId}` | String | 最新心跳时间戳             | 120 秒   | 过期自动离线        |
| `device:runtimeInfo:{deviceId}` | String | 运行数据 JSON 字符串       | 300 秒   | 查询直接读取        |
| `nodes:online`               | Set    | 在线实例 UUID 列表         | 无       | 用于节点管理        |
| `node:heartbeat:{nodeId}`    | String | 实例心跳时间戳             | 120 秒   | 超时移除节点        |
| `lock:node:master`           | String | 分布式锁（主节点选举）     | 30 秒    | 防止重复扫描        |

### 5.2 Pub/Sub Channel

| Channel 名称                 | 事件类型     | Payload 示例                                      |
|------------------------------|-------------|---------------------------------------------------|
| `client:status:change`       | 状态变更     | `{"deviceId":"xxx","status":"online","timestamp":123}` |
| `client:heartbeat`           | 心跳事件     | `{"deviceId":"xxx","timestamp":123}`              |
| `client:data:request`        | 数据请求     | `{"deviceId":"xxx","requestId":"req-123"}`        |
| `client:data:updated`        | 数据更新     | `{"deviceId":"xxx","requestId":"req-123"}`        |

---

## 六、架构示意图（文字描述）

```
┌─────────────────────────────────────────────────────────────┐
│                        第三方系统                             │
│              (https://ip/device/api/updateDeviceStatus)      │
└─────────────────────────┬───────────────────────────────────┘
                          │ HTTP POST
                          ▼
┌─────────────────────────────────────────────────────────────┐
│                         Nginx                                │
│     (WSS 443 → Load Balancer → least_conn 策略)             │
└─────┬───────────────┬───────────────┬───────────────────────┘
      │               │               │
      ▼               ▼               ▼
┌───────────┐   ┌───────────┐   ┌───────────┐
│ Instance 1│   │ Instance 2│   │ Instance 3│  (Spring Boot + Netty)
└─────┬─────┘   └─────┬─────┘   └─────┬─────┘
      │               │               │
      └───────────────┼───────────────┘
                      │
          ┌───────────▼─────────────┐
          │      Redis Server       │
          │  (Pub/Sub + 状态存储)   │
          └─────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      客户端设备群                             │
│      (WSS 连接 → 自动重连 → 心跳 30s → 数据上报)              │
└─────────────────────────────────────────────────────────────┘
```

---

## 七、开发优先级建议

### 第一阶段（核心功能）

1. ✅ F001-F002：客户端连接与注册
2. ✅ F003-F005：心跳检测与离线判断
3. ✅ Redis 数据结构和 Pub/Sub 基础设施

### 第二阶段（数据查询）

1. ✅ F006-F007：运行数据查询与上报
2. ✅ 跨节点通信（Pub/Sub 请求/响应）

### 第三阶段（通知与监控）

1. ✅ F008-F009：第三方状态通知（含重试机制）
2. ✅ F010-F012：多实例节点管理

### 第四阶段（优化与日志）

1. ✅ F013-F014：日志与异常处理
2. ✅ 性能测试与调优

---

**文档版本**：v1.0
**最后更新**：2025-01-16
**维护者**：PulseLink 开发团队
